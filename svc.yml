name: {{FRAMEWORK_NAME}}
scheduler:
  principal: {{FRAMEWORK_PRINCIPAL}}
  user: {{FRAMEWORK_USER}}
pods:
  hivemq:
    image: {{HIVEMQ_IMAGE}}
    count: {{NODE_COUNT}}
    allow-decommission: true
    placement: '{{{NODE_PLACEMENT}}}'
    {{#ENABLE_VIRTUAL_NETWORK}}
      networks:
        {{VIRTUAL_NETWORK_NAME}}:
    labels: {{VIRTUAL_NETWORK_PLUGIN_LABELS}}
    {{/ENABLE_VIRTUAL_NETWORK}}
    uris:
      - {{HIVEMQ_URI}}
    tasks:
      node:
        goal: RUNNING
        cmd: |
          exec /opt/hivemq/bin/run.sh
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        volume:
          path: "test-container-path"
          type: {{NODE_DISK_TYPE}}
          size: {{NODE_DISK}}
        discovery:
          prefix: {{FRAMEWORK_NAME}}
        labels: "HAPROXY_GROUP:external"
        env:
          HIVEMQ_DNS_DISCOVERY_INTERVAL: 30
          HIVEMQ_CONTROL_CENTER_USER: admin
          HIVEMQ_CONTROL_CENTER_PASSWORD: a68fc32fc49fc4d04c63724a1f6d0c90442209c46dba6975774cde5e5149caf8
        health-check:
          cmd: "exec /opt/hivemq/bin/healthcheck"
          interval: 60
          grace-period: 60
          max-consecutive-failures: 60
          delay: 10
          timeout: 30
        readiness-check:
          cmd: "exec /opt/hivemq/bin/healthcheck"
          interval: 60
          delay: 30
          timeout: 30
        ports:
          mqtt:
            port: 0
            env-key: HIVEMQ_MQTT_PORT
            advertise: true
            vip:
              port: 1883
          cluster:
            port: 0
            env-key: HIVEMQ_CLUSTER_PORT
            advertise: true
          control-center:
            port: 0
            env-key: HIVEMQ_CONTROL_CENTER_PORT
            advertise: true
plans:
  deploy:
    strategy: serial
    phases:
      node:
        strategy: serial
        pod: hivemq
  update:
    strategy: serial
    phases:
      rolling-upgrade:
        strategy: serial
        pod: hivemq